!function(){var t=Object.create(HTMLElement.prototype);t.clearContent=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.isParentOf=function(t,e){for(var a=t.parentNode;a;){if(a===e)return!0;a=a.parentNode}return!1},t.directChildren=function(t,e){var a=Array.isArray(t)?t:[t],i=[];return[].forEach.call(a,function(t){[].forEach.call(t.children,function(t){t.tagName==e.toUpperCase()&&i.push(t)})}),i},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.fireEvent=function(t,e,a){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,!1,!0,e),a.dispatchEvent(i)},t.buildUrl=function(t,e,a){var i,r="";if("pushstate"!=a&&"#"!=t[0]&&(r=""),i=r+t,e){var n=i.match(/:[a-zA-Z0-9%_]+/g)||[],s=[];n.forEach(function(t){var a=t.slice(1);"undefined"!=typeof e[a]&&(i=i.replace(t,encodeURIComponent(e[a])),s.push(a))});for(var h in e)s.indexOf(h)<0&&(i+=i.indexOf("?")<0?"?"+encodeURIComponent(h)+"="+encodeURIComponent(e[h]):"&"+encodeURIComponent(h)+"="+encodeURIComponent(e[h]))}return i},t.parseUrl=function(t,e){var a={isHashPath:"hash"===e};if("function"==typeof URL){var i=new URL(t);a.path=i.pathname,a.hash=i.hash,a.search=i.search}else{var r=document.createElement("a");r.href=t,a.path=r.pathname,"/"!==a.path.charAt(0)&&(a.path="/"+a.path),a.hash=r.hash,a.search=r.search}if("pushstate"!==e&&("#/"===a.hash.substring(0,2)?(a.isHashPath=!0,a.path=a.hash.substring(1)):"#!/"===a.hash.substring(0,3)?(a.isHashPath=!0,a.path=a.hash.substring(2)):a.isHashPath&&(a.path=0===a.hash.length?"/":a.hash.substring(1)),a.isHashPath)){a.hash="";var n=a.path.indexOf("#");-1!==n&&(a.hash=a.path.substring(n),a.path=a.path.substring(0,n));var s=a.path.indexOf("?");-1!==s&&(a.search=a.path.substring(s),a.path=a.path.substring(0,s))}return a},t.testRoute=function(t,e,a,i){return"ignore"===a&&("/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"!==t.slice(-1)||i||(t=t.slice(0,-1))),i?this.testRegExString(t,e):t===e||"*"===t?!0:("/"!==t.charAt(0)&&(t="/**/"+t),this.segmentsMatch(t.split("/"),1,e.split("/"),1))},t.segmentsMatch=function(t,e,a,i,r){var n=t[e]||"",s=a[i]||"";if("**"===n&&e===t.length-1)return!0;if(""===n||""===s)return n===s;if(n===s||"*"===n||":"===n.charAt(0))return":"===n.charAt(0)&&"undefined"!=typeof r&&(r[n.substring(1)]=a[i]),this.segmentsMatch(t,e+1,a,i+1,r);if("**"===n)for(var h=i;h<a.length;h++)if(this.segmentsMatch(t,e+1,a,h,r))return!0;return!1},t.routeArguments=function(t,e,a,i,r){var n={};i||("/"!==t.charAt(0)&&(t="/**/"+t),this.segmentsMatch(t.split("/"),1,e.split("/"),1,n));var s=a.substring(1).split("&");1===s.length&&""===s[0]&&(s=[]);for(var h=0;h<s.length;h++){var o=s[h],c=o.split("=");n[c[0]]=c.splice(1,c.length-1).join("=")}if(r)for(var l in n)n[l]=this.typecast(n[l]);return n},t.typecast=function(t){return"true"===t?!0:"false"===t?!1:isNaN(t)||""===t||"0"===t.charAt(0)?decodeURIComponent(t):+t},t.testRegExString=function(t,e){if("/"!==t.charAt(0))return!1;t=t.slice(1);var a="";if("/"===t.slice(-1))t=t.slice(0,-1);else{if("/i"!==t.slice(-2))return!1;t=t.slice(0,-2),a="i"}return new RegExp(t,a).test(e)},document.registerElement("states-helper",{prototype:t})}(),function(){function t(t){this.name=t,this.internalCache={}}function e(e){var i=a[e];return i||(a[e]=i=new t(e)),i}t.prototype.get=function(t){return this.internalCache[t]},t.prototype.set=function(t,e){if(this.get(t))throw Error("Already have an id :"+t);this.internalCache[t]=e},t.prototype.del=function(t){if(!this.get(t))throw Error("Cannot delete a non-existing id :"+t);delete this.internalCache[t]},t.prototype.items=function(){return this.internalCache},t.prototype.itemsArray=function(){var t=[];for(var e in this.internalCache)t.push(this.internalCache[e]);return t};var a={},i=Object.create(HTMLElement.prototype);i.getCache=function(t){return e.call(this,t)},document.registerElement("view-registry",{prototype:i})}(),function(){Polymer("place-holder",{created:function(){if(!this.hasAttribute("id"))throw Error("place-holder should vahe a unique id");this.cache=document.createElement("view-registry").getCache("place-holder:id"),this.cache.set("#"+this.id,this)},clearContent:function(){for(;this.firstChild;)this.removeChild(this.firstChild)},loadInto:function(t,e){for(var a,i=[],r=0,n=this.attributes,s=n.length;s>r;r++)a=n[r],"ID"!=a.nodeName.toUpperCase()&&i.push(a.nodeName.toUpperCase());for(var h in t){this.setAttribute(h,t[h]);var o=i.indexOf(h.toUpperCase());o>=0&&i.splice(o,1)}i.forEach(function(t){this.removeAttribute(t)}.bind(this)),this.appendChild(e)},detached:function(){this.cache.del("#"+this.id)}})}(),function(){Polymer("virtual-view",{virtualHolder:"__$virtual$",created:function(){this.holderCache=document.createElement("view-registry").getCache("place-holder:id"),this.cache=document.createElement("view-registry").getCache("virtual-view:target"),this.target=this.getAttribute("target"),this.target||(this.target=this.virtualHolder,this.setAttribute("target",this.target));var t=this.cache.get(this.target);t?t.push(this):this.cache.set(this.target,[this]);var e=["ID","TARGET","HIDDEN","EL","DISCARDATTR"];if(this.hasAttribute("discardAttr")){var a=this.getAttribute("discardAttr").split(" ");a.forEach(function(t){e.push(t.toUpperCase())})}this.discardAttr=e},detached:function(){delete this.instance;var t=this.cache.get(this.target);t&&t.length&&t.indexOf(this)>=0&&t.splice(t.indexOf(this),1)},changeModel:function(t){var e=this.templateUsed?this.instance.templateInstance.model:this.instance;for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},clearContent:function(){if(this.instance){var t=this.holderCache.get(this.target);t||this.target==this.virtualHolder?(t?t.clearContent():document.body.removeChild(this.instance),delete this.instance,delete this.templateUsed):console.log("virtual-view:Clear: Cannot locate target "+this.target)}},loadIntoHolder:function(t,e){for(var a,i={},r=0,n=this.attributes,s=n.length;s>r;r++)a=n[r],this.discardAttr.indexOf(a.nodeName.toUpperCase())<0&&(i[a.nodeName]=a.value||a.nodeValue);t.loadInto(i,e)},loadInto:function(t,e){var a,i=this;if(t){var r=this.cache.get(this.target);r.forEach(function(t){i!=t&&t.instance&&t.target!=i.virtualHolder&&t.clearContent()}),t.clearContent()}if(this.el)a=document.createElement(this.el);else{var n=this.firstElementChild;n&&"TEMPLATE"==n.tagName&&(a=n.createInstance(e),this.templateUsed=!0)}if(a)if(t){if(this.instance=a,!this.templateUsed)for(var s in e)e.hasOwnProperty(s)&&(a[s]=e[s]);this.loadIntoHolder(t,this.instance)}else{if(this.templateUsed){var h=document.createElement("div");h.appendChild(a),this.instance=h}else this.instance=a;document.body.appendChild(this.instance)}},loadContent:function(t){if(this.instance)throw Error("Presenter already loaded. Clear first.");var e=this.holderCache.get(this.target);if(!e&&this.target!=this.virtualHolder)throw Error("Presenter should have a valid el attribute or first child should be template element.");this.loadInto(e,t)}})}(),function(){function t(t,e,a){var i=[];return e.forEach(function(e){t.forEach(function(t){t.forEach(function(t){t.parentNode===e&&i.push(a?a(t):t)})})}),i}function e(t,e){e=e||[];var a=function(t){for(var e=t.nextElementSibling;e;)"APP-STATE"==e.tagName&&e.loaded&&e.unLoad(),e=e.nextElementSibling;for(var a=t.previousElementSibling;a;)"APP-STATE"==a.tagName&&a.loaded&&a.unLoad(),a=a.previousElementSibling},i=t.parentNode;for(e.splice(0,0,t);i&&"APP-STATE"===i.tagName;)e.splice(0,0,i),a(i),i=i.parentNode;a(t);var r=t.querySelectorAll("app-state");[].map.call(r,function(t){t&&"APP-STATE"==t.tagName&&t.loaded&&t.unLoad()})}function a(e,a,i){var r=function(t,e,a){for(var i=e.map(function(t){return t.target}),r=a.map(function(t){return t.target}),n=t.loaded,s=0;s<i.length;s++){var h=e[s];r.indexOf(i[s])<0&&(n?("undefined"!=typeof t.forceReload&&(t.unLoad(),n=!1),h.instance?h.changeModel(t.getModel()):h.loadContent(t.getModel())):h.loadContent(t.getModel()))}n||(t.loaded=!0,console.log("State loaded:"+(t.id||t.header||"anonymous")))};i=i||[];for(var n=0;n<e.length;n++){var s=e[n],h=t(a,[s]),o=t(a,e.slice(n+1));r.call(this,s,h,o)}}Polymer("app-state",{get parentState(){for(var t=this.parentNode;t;){if("APP-STATE"==t.tagName)return t;t=t.parentNode}},getStateManager:function(){for(var t=this.parentNode;t;){if("APP-STATE-MANAGER"==t.tagName)return t;t=t.parentNode}},created:function(){this.stateViewCache=document.createElement("view-registry").getCache("virtual-view:target")},ready:function(){if(this.hasAttribute("childStates")){var t=this.getAttribute("childStates");if("undefined"!=typeof t){var e=document.createElement(t),a=this.$.helper.directChildren(e.shadowRoot,"app-state");a.forEach(function(t){this.appendChild(t)}.bind(this))}}},attached:function(){this.stateManager=this.getStateManager(),this.stateManager||(this.stateManager=document.querySelector("body /deep/ app-state-manager"))},getModel:function(){for(var t=this.stateManager.parseUrl(),e=this.$.helper.routeArguments(this.url,t.path,t.search,this.regex,"auto"===this.stateManager.typecast),a=this.model,i=this.parentNode;!a&&i&&("APP-STATE"==i.tagName||"APP-STATE-MANAGER"==i.tagName);)a=i.model,i=i.parentNode;if(a&&a!==this.model){var r=Object.create(a);a=r}return{model:a,urlParams:e,state:this}},load:function(){if(this.hasAttribute("redirect"))return this.stateManager.go(this.getAttribute("redirect"),{replace:!0}),void 0;var t=[];e(this,t),a.call(this,t,this.stateViewCache.itemsArray())},buildUrl:function(t){return this.$.helper.buildUrl(this.url,t,this.stateManager.mode)},unLoad:function(){for(var e=this,a=this.children[0];a;)"APP-STATE"==a.tagName&&a.loaded&&a.unLoad(),a=a.nextElementSibling;{var i=this.stateViewCache.itemsArray();t(i,[e],function(t){return t.clearContent(),t})}delete e.loaded,console.log("State unloaded: "+(e.id||e.header||"anonymous"))}})}(),function(){function t(e,a){var i=e.url;"undefined"==typeof i&&(e.url=e.urlPostfix?e.parentState.url+e.urlPostfix+"/":a,i=a);for(var r=e.children[0];r;)"APP-STATE"==r.tagName&&t(r,i+r.id+"/"),r=r.nextElementSibling}var e="ActiveXObject"in window,a={};Polymer("app-state-manager",{matchState:function(t){"string"==typeof t&&(t=this.$.helper.parseUrl(t,this.mode));for(var e,a=this.querySelectorAll("app-state"),i=0;i<a.length;i++){var r=a[i];if(this.$.helper.testRoute(r.url,t.path,this.trailingSlash,r.regex)){e=r;break}}var n={match:e};return this.$.helper.fireEvent("state-match",n,this),n.match},getStateById:function(t){return this.querySelector("#"+t)},gotoState:function(t){if("string"==typeof t){var e=this.getStateById(t);if(!e)throw Error("unable to locate state:"+t);t=e}var a={from:this.currentState,to:t};if(this.$.helper.fireEvent("state-changing",a,this)){t.load(),this.oldState=this.currentState,this.currentState=t;var i={oldState:this.oldState,currentState:t};this.$.helper.fireEvent("state-changed",i,this),this.$.helper.fireEvent("app-state-changed",i,document)}},go:function(t,e){"pushstate"!==this.mode&&(t="#"+t),e&&e.replace===!0?window.history.replaceState(null,null,t):window.history.pushState(null,null,t);try{var a=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:{}});"dispatchEvent_"in window?window.dispatchEvent_(a):window.dispatchEvent(a)}catch(i){var r=document.createEvent("CustomEvent");r.initCustomEvent("popstate",!1,!1,{state:{}}),window.dispatchEvent(r)}},parseUrl:function(t,e){return t=t||window.location.href,e=e||this.mode,this.$.helper.parseUrl(t,e)},created:function(){window.appStateManager=window.appStateManager||this},urlChangeHandler:function(){var t=this.parseUrl();if(t.hash!==a.hash&&t.path===a.path&&t.search===a.search&&t.isHashPath===a.isHashPath)return this.scrollToHash(t.hash),void 0;var e=this.matchState(t);if(e&&"undefined"!=typeof e.forceReload);else if(a.isHashPath===t.isHashPath&&a.hash===t.hash&&a.path===t.path&&a.search===t.search)return;a=t;var i={url:t};if(this.$.helper.fireEvent("url-change",i,this)){var r=this.matchState(t);r&&this.gotoState(r)}},scrollToHash:function(t){t&&setTimeout(function(){var e=document.querySelector("html /deep/ "+t)||document.querySelector('html /deep/ [name="'+t.substring(1)+'"]');e&&e.scrollIntoView&&e.scrollIntoView(!0)},0)},init:function(){this.isInited||(this.isInited=!0,this.mode=this.mode||"auto",this.trailingSlash=this.trailingSlash||"strict",this.typecast=this.typecast||"auto",window.addEventListener("popstate",this.urlChangeHandler.bind(this),!1),e&&window.addEventListener("hashchange",this.router.urlChangeHandler.bind(this),!1),this.urlChangeHandler(),this.$.helper.fireEvent("states-inited",{},this))},domReady:function(){"manual"!==this.getAttribute("init")&&this.init()},ready:function(){var e=this.root=this.querySelector("app-state:first-child");e&&t.call(this,e,"/")},detached:function(){window.removeEventListener("popstate",this.stateChangeHandler,!1),e&&window.removeEventListener("hashchange",this.stateChangeHandler,!1)}})}();